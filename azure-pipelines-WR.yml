# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
  - none

pool:
  vmImage: windows-2019

stages:
  - stage: aaa
    jobs:
      - job: bbb
        variables:
          npm_config_cache: $(Pipeline.Workspace)/.npm
        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: "10.x"
            displayName: "Install Node.js"

          - task: CacheBeta@0
            inputs:
              key: $(Build.SourcesDirectory)/bcd-e2e-tests/package-lock.json
              path: $(npm_config_cache)
            displayName: Cache npm

          - task: CacheBeta@0
            inputs:
              key: $(Build.SourcesDirectory)/bcd-e2e-tests/package-lock.json
              path: "C:/Users/VssAdministrator/AppData/Local/ms-playwright"
            displayName: Cache browser

          - script: |
              cd bcd-e2e-tests
              npm ci
            displayName: "install"

          - script: |
              cd bcd-e2e-tests
              npm run e2e -- spec/citest.js
            displayName: "test"

          - script: |
              cd bcd-e2e-tests
              npm run e2e-report
            displayName: "report"
#  workingDirectory: '$(Build.SourcesDirectory)/bcd-e2e-tests'

# - task: PublishTestResults@2
#   condition: succeededOrFailed()
#   inputs:
#     testRunner: JUnit
#     testResultsFiles: '**/*.json'

# - task: PublishPipelineArtifact@1
#   inputs:
#     targetPath: $(Build.SourcesDirectory)/build
#     artifactName: report
# - task: DownloadPipelineArtifact@2
#   inputs:
#     patterns: '**/*.zip'
